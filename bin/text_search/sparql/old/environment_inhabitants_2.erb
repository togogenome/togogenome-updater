PREFIX mccv: <http://purl.jp/bio/01/mccv#>
PREFIX meo: <http://purl.jp/bio/11/meo/>

SELECT (?strain_number AS ?source_id) (?strain_name AS ?organism_name)
  ?isolation ((sql:GROUP_DIGEST(?meo_label , ',', 1000, 1)) AS ?meo_labels)
FROM <http://togogenome.org/graph/taxonomy>
FROM <http://togogenome.org/graph/brc>
FROM <http://togogenome.org/graph/meo>
WHERE
{
  VALUES ?related_type { mccv:MCCV_000056 mccv:MCCV_000022 mccv:MCCV_000057 }
  { SELECT DISTINCT ?strain_id
    {
      VALUES ?meo_mapping { mccv:MCCV_000059 mccv:MCCV_000060 }
      ?meo_id rdfs:subClassOf* <<%= meo_id %>> .
      ?strain_id ?meo_mapping ?meo_id .
      ?strain_id rdf:type mccv:MCCV_000001 .
    }
  }
  OPTIONAL { ?strain_id mccv:MCCV_000010 ?strain_number . }
  OPTIONAL { ?strain_id mccv:MCCV_000012 ?strain_name . }
  OPTIONAL { ?strain_id mccv:MCCV_000030 ?isolation . }
  OPTIONAL
  {
    ?strain_id mccv:MCCV_000059|mccv:MCCV_000060 ?meo_id .
    ?meo_id rdfs:label ?meo_label .
  }
  OPTIONAL
  {
    ?strain_id ?related_type ?tax_id FILTER (STRSTARTS(STR(?tax_id),"http://identifiers.org/")) .
    BIND (REPLACE(STR(?tax_id),"http://identifiers.org/taxonomy/","") AS ?tax_no) .
  }
} GROUP BY ?strain_id ?strain_number ?strain_name ?isolation
